<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Capítulo 4 NERd (Implementación) | NERd: anotador eficiente de modelos estadísticos para el reconocimiento de entidades nombradas</title>
  <meta name="description" content="Proyecto final de la carrera de ingeniería informática. ITBA." />
  <meta name="generator" content="bookdown 0.15.4 and GitBook 2.6.7" />

  <meta property="og:title" content="Capítulo 4 NERd (Implementación) | NERd: anotador eficiente de modelos estadísticos para el reconocimiento de entidades nombradas" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Proyecto final de la carrera de ingeniería informática. ITBA." />
  <meta name="github-repo" content="qcho/nerd-pf" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Capítulo 4 NERd (Implementación) | NERd: anotador eficiente de modelos estadísticos para el reconocimiento de entidades nombradas" />
  
  <meta name="twitter:description" content="Proyecto final de la carrera de ingeniería informática. ITBA." />
  

<meta name="author" content="Horacio Miguel Gómez (L:50825)" />
<meta name="author" content="Juan Pablo Orsay (L:49373)" />
<meta name="author" content="Lic. Diego Ariel Aizemberg (Tutor)" />
<meta name="author" content="Proyecto final de carrera" />


<meta name="date" content="2019-12-17" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="state-of-art.html"/>
<link rel="next" href="results.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Named Entity Recognition Duh!</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introducción</a></li>
<li class="chapter" data-level="2" data-path="problem-definition.html"><a href="problem-definition.html"><i class="fa fa-check"></i><b>2</b> Definición del problema</a><ul>
<li class="chapter" data-level="2.1" data-path="problem-definition.html"><a href="problem-definition.html#conceptos-básicos"><i class="fa fa-check"></i><b>2.1</b> Conceptos básicos</a><ul>
<li class="chapter" data-level="2.1.1" data-path="problem-definition.html"><a href="problem-definition.html#entidad-nombrada"><i class="fa fa-check"></i><b>2.1.1</b> Entidad nombrada</a></li>
<li class="chapter" data-level="2.1.2" data-path="problem-definition.html"><a href="problem-definition.html#reconocimiento-de-entidades"><i class="fa fa-check"></i><b>2.1.2</b> Reconocimiento de entidades</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="problem-definition.html"><a href="problem-definition.html#los-datos-son-el-problema"><i class="fa fa-check"></i><b>2.2</b> Los datos son el problema</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="state-of-art.html"><a href="state-of-art.html"><i class="fa fa-check"></i><b>3</b> Estado del arte</a><ul>
<li class="chapter" data-level="3.1" data-path="state-of-art.html"><a href="state-of-art.html#stack-de-software"><i class="fa fa-check"></i><b>3.1</b> Stack de software</a></li>
<li class="chapter" data-level="3.2" data-path="state-of-art.html"><a href="state-of-art.html#el-pipeline"><i class="fa fa-check"></i><b>3.2</b> El pipeline</a></li>
<li class="chapter" data-level="3.3" data-path="state-of-art.html"><a href="state-of-art.html#algoritmo-de-tokenización"><i class="fa fa-check"></i><b>3.3</b> Algoritmo de tokenización</a></li>
<li class="chapter" data-level="3.4" data-path="state-of-art.html"><a href="state-of-art.html#modelos-basados-en-reglas"><i class="fa fa-check"></i><b>3.4</b> Modelos basados en reglas</a></li>
<li class="chapter" data-level="3.5" data-path="state-of-art.html"><a href="state-of-art.html#modelos-de-deep-learning"><i class="fa fa-check"></i><b>3.5</b> Modelos de “<em>deep-learning</em>”</a><ul>
<li class="chapter" data-level="3.5.1" data-path="state-of-art.html"><a href="state-of-art.html#embed"><i class="fa fa-check"></i><b>3.5.1</b> <em>Embed</em></a></li>
<li class="chapter" data-level="3.5.2" data-path="state-of-art.html"><a href="state-of-art.html#encode"><i class="fa fa-check"></i><b>3.5.2</b> <em>Encode</em></a></li>
<li class="chapter" data-level="3.5.3" data-path="state-of-art.html"><a href="state-of-art.html#attend"><i class="fa fa-check"></i><b>3.5.3</b> <em>Attend</em></a></li>
<li class="chapter" data-level="3.5.4" data-path="state-of-art.html"><a href="state-of-art.html#predict"><i class="fa fa-check"></i><b>3.5.4</b> <em>Predict</em></a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="state-of-art.html"><a href="state-of-art.html#use-of-cnn"><i class="fa fa-check"></i><b>3.6</b> Uso del modelo estadístico</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="implementation.html"><a href="implementation.html"><i class="fa fa-check"></i><b>4</b> NERd (Implementación)</a><ul>
<li class="chapter" data-level="4.1" data-path="implementation.html"><a href="implementation.html#vista-lógica"><i class="fa fa-check"></i><b>4.1</b> Vista lógica</a><ul>
<li class="chapter" data-level="4.1.1" data-path="implementation.html"><a href="implementation.html#web"><i class="fa fa-check"></i><b>4.1.1</b> Web</a></li>
<li class="chapter" data-level="4.1.2" data-path="implementation.html"><a href="implementation.html#api"><i class="fa fa-check"></i><b>4.1.2</b> <em>API</em></a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="implementation.html"><a href="implementation.html#vista-de-proceso"><i class="fa fa-check"></i><b>4.2</b> Vista de proceso</a><ul>
<li class="chapter" data-level="4.2.1" data-path="implementation.html"><a href="implementation.html#cliente-web"><i class="fa fa-check"></i><b>4.2.1</b> Cliente web</a></li>
<li class="chapter" data-level="4.2.2" data-path="implementation.html"><a href="implementation.html#api-1"><i class="fa fa-check"></i><b>4.2.2</b> <em>API</em></a></li>
<li class="chapter" data-level="4.2.3" data-path="implementation.html"><a href="implementation.html#worker"><i class="fa fa-check"></i><b>4.2.3</b> Worker</a></li>
<li class="chapter" data-level="4.2.4" data-path="implementation.html"><a href="implementation.html#task-scheduler"><i class="fa fa-check"></i><b>4.2.4</b> Task Scheduler</a></li>
<li class="chapter" data-level="4.2.5" data-path="implementation.html"><a href="implementation.html#base-de-datos"><i class="fa fa-check"></i><b>4.2.5</b> Base de datos</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="implementation.html"><a href="implementation.html#vista-de-desarrollo"><i class="fa fa-check"></i><b>4.3</b> Vista de desarrollo</a><ul>
<li class="chapter" data-level="4.3.1" data-path="implementation.html"><a href="implementation.html#cliente-web-1"><i class="fa fa-check"></i><b>4.3.1</b> Cliente web</a></li>
<li class="chapter" data-level="4.3.2" data-path="implementation.html"><a href="implementation.html#api-2"><i class="fa fa-check"></i><b>4.3.2</b> <em>API</em></a></li>
<li class="chapter" data-level="4.3.3" data-path="implementation.html"><a href="implementation.html#worker-1"><i class="fa fa-check"></i><b>4.3.3</b> Worker</a></li>
<li class="chapter" data-level="4.3.4" data-path="implementation.html"><a href="implementation.html#task-scheduler-1"><i class="fa fa-check"></i><b>4.3.4</b> <em>Task Scheduler</em></a></li>
<li class="chapter" data-level="4.3.5" data-path="implementation.html"><a href="implementation.html#MongoDBDev"><i class="fa fa-check"></i><b>4.3.5</b> Base de Datos</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="implementation.html"><a href="implementation.html#vista-física"><i class="fa fa-check"></i><b>4.4</b> Vista física</a><ul>
<li class="chapter" data-level="4.4.1" data-path="implementation.html"><a href="implementation.html#docker"><i class="fa fa-check"></i><b>4.4.1</b> <em>Docker</em></a></li>
<li class="chapter" data-level="4.4.2" data-path="implementation.html"><a href="implementation.html#deployment"><i class="fa fa-check"></i><b>4.4.2</b> Deployment</a></li>
<li class="chapter" data-level="4.4.3" data-path="implementation.html"><a href="implementation.html#servicios"><i class="fa fa-check"></i><b>4.4.3</b> Servicios</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="implementation.html"><a href="implementation.html#escenarios"><i class="fa fa-check"></i><b>4.5</b> Escenarios</a><ul>
<li class="chapter" data-level="4.5.1" data-path="implementation.html"><a href="implementation.html#inferencia-de-entidades-utilizando-el-api"><i class="fa fa-check"></i><b>4.5.1</b> Inferencia de entidades utilizando el API</a></li>
<li class="chapter" data-level="4.5.2" data-path="implementation.html"><a href="implementation.html#corrección-de-entidades-utilizando-el-entrenador"><i class="fa fa-check"></i><b>4.5.2</b> Corrección de entidades utilizando el entrenador</a></li>
<li class="chapter" data-level="4.5.3" data-path="implementation.html"><a href="implementation.html#habilitar-snapshots"><i class="fa fa-check"></i><b>4.5.3</b> Habilitar snapshots</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="results.html"><a href="results.html"><i class="fa fa-check"></i><b>5</b> Resultados de entrenamiento</a><ul>
<li class="chapter" data-level="5.1" data-path="results.html"><a href="results.html#métrica-valor-f"><i class="fa fa-check"></i><b>5.1</b> Métrica: Valor-F</a></li>
<li class="chapter" data-level="5.2" data-path="results.html"><a href="results.html#result-data"><i class="fa fa-check"></i><b>5.2</b> Resultados obtenidos</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="discussion.html"><a href="discussion.html"><i class="fa fa-check"></i><b>6</b> Discusión</a><ul>
<li class="chapter" data-level="6.1" data-path="discussion.html"><a href="discussion.html#analisis-de-resultados"><i class="fa fa-check"></i><b>6.1</b> Analisis de resultados</a></li>
<li class="chapter" data-level="6.2" data-path="discussion.html"><a href="discussion.html#tipos-de-entidades"><i class="fa fa-check"></i><b>6.2</b> Tipos de entidades</a></li>
<li class="chapter" data-level="6.3" data-path="discussion.html"><a href="discussion.html#semilla-inicial"><i class="fa fa-check"></i><b>6.3</b> Semilla inicial</a></li>
<li class="chapter" data-level="6.4" data-path="discussion.html"><a href="discussion.html#entrenamiento-live-vs-offline"><i class="fa fa-check"></i><b>6.4</b> Entrenamiento <em>live</em> vs <em>offline</em></a></li>
<li class="chapter" data-level="6.5" data-path="discussion.html"><a href="discussion.html#linkeo-de-entidades-con-knowledge-base"><i class="fa fa-check"></i><b>6.5</b> <em>Linkeo</em> de entidades con <em>Knowledge Base</em></a></li>
<li class="chapter" data-level="6.6" data-path="discussion.html"><a href="discussion.html#utilidad-de-la-herramienta"><i class="fa fa-check"></i><b>6.6</b> Utilidad de la herramienta</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="conclusiones.html"><a href="conclusiones.html"><i class="fa fa-check"></i><b>7</b> Conclusiones</a></li>
<li class="chapter" data-level="" data-path="anexo-datos-de-resultados.html"><a href="anexo-datos-de-resultados.html"><i class="fa fa-check"></i>Anexo: Datos de resultados</a><ul>
<li class="chapter" data-level="7.1" data-path="anexo-datos-de-resultados.html"><a href="anexo-datos-de-resultados.html#t-0---v-100.-baseline-spacy"><i class="fa fa-check"></i><b>7.1</b> t: 0% - v: 100%. <em>Baseline spaCy</em></a></li>
<li class="chapter" data-level="7.2" data-path="anexo-datos-de-resultados.html"><a href="anexo-datos-de-resultados.html#t-50---v-50"><i class="fa fa-check"></i><b>7.2</b> t: 50% - v: 50%</a></li>
<li class="chapter" data-level="7.3" data-path="anexo-datos-de-resultados.html"><a href="anexo-datos-de-resultados.html#t-75---v-25"><i class="fa fa-check"></i><b>7.3</b> t: 75% - v: 25%</a></li>
<li class="chapter" data-level="7.4" data-path="anexo-datos-de-resultados.html"><a href="anexo-datos-de-resultados.html#t-80---v-20"><i class="fa fa-check"></i><b>7.4</b> t: 80% - v: 20%</a></li>
<li class="chapter" data-level="7.5" data-path="anexo-datos-de-resultados.html"><a href="anexo-datos-de-resultados.html#t-85---v-15"><i class="fa fa-check"></i><b>7.5</b> t: 85% - v: 15%</a></li>
<li class="chapter" data-level="7.6" data-path="anexo-datos-de-resultados.html"><a href="anexo-datos-de-resultados.html#t-90---v-10"><i class="fa fa-check"></i><b>7.6</b> t: 90% - v: 10%</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="glosario.html"><a href="glosario.html"><i class="fa fa-check"></i>Glosario</a></li>
<li class="chapter" data-level="" data-path="referencias.html"><a href="referencias.html"><i class="fa fa-check"></i>Referencias</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">NERd: anotador eficiente de modelos estadísticos para el reconocimiento de entidades nombradas</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="implementation" class="section level1">
<h1><span class="header-section-number">Capítulo 4</span> NERd (Implementación)</h1>
<p>Definido el problema, queda claro que la creación de un modelo entrenado es de vital importancia para cualquier problema de etiquetado de entidades.
Es por ello que en el presente proyecto final hemos creado una herramienta para el entrenamiento eficiente de modelos estadísticos así como también una interfaz y API para poder consultar entidades.</p>
<p>Para organizar este capítulo vamos a realizar una descripción basada en el modelo de vistas de arquitectura 4+1 (Figura <a href="implementation.html#fig:arq41">4.1</a>).</p>
<div class="figure" style="text-align: center"><span id="fig:arq41"></span>
<img src="assets/4+1_Architectural_View_Model.svg" alt="Ilustración de arquitectura 4+1."  />
<p class="caption">
Figura 4.1: Ilustración de arquitectura 4+1.
</p>
</div>
<p>Este modelo nos permite describir la aplicación de una manera genérica y ordenada.</p>
<blockquote>
<p><em>The “4+1” view model is rather “generic”: other notations and tools can be used, other design methods can be used, especially for the logical and process decompositions, but we have indicated the ones we have used with success.</em></p>
<footer>
— <span class="citation">(Kruchten, <a href="#ref-Kruchten:1995:VMA:624610.625529">1995</a>)</span>
</footer>
</blockquote>
<div id="vista-lógica" class="section level2">
<h2><span class="header-section-number">4.1</span> Vista lógica</h2>
<blockquote>
<p>La vista lógica se refiere a la funcionalidad que el sistema proporciona a los usuarios finales.</p>
</blockquote>
<p>A continuación detallamos distintas partes del servicio NERd así como también de la interfaz de entrenamiento.</p>
<!-- Los diagramas UML se utilizan para representar la vista lógica e incluyen diagramas de clase y diagramas de estado. -->
<div id="web" class="section level3">
<h3><span class="header-section-number">4.1.1</span> Web</h3>
<p>La página <em>web</em> de <em>NERd</em> está enfocada en las tareas de mantenimiento de los servicios ofrecidos por el <em>API</em> así como también ofrece de interfaces que permiten a usuarios del sistema corregir de manera eficiente el modelo de inferencia.</p>
<div id="inicio" class="section level4">
<h4><span class="header-section-number">4.1.1.1</span> Inicio</h4>
<p>La pantalla de inicio es donde se encuentran los accesos rápidos para entrenar el modelo o para buscar entidades en textos.
También se encuentra aquí una lista de los 5 usuarios que más contribuyeron a entrenar el modelo. Detrás de esta funcionalidad se busca generar un espíritu competitivo entre los usuarios para que los mismos busquen contribuir más (Figura <a href="implementation.html#fig:logic-home">4.2</a>). A este tipo de técnicas se las denomina <em>gamification</em>.</p>
<div class="figure" style="text-align: center"><span id="fig:logic-home"></span>
<img src="assets/logic/home-logged-all.png" alt="Pantalla de inicio con usuario logueado."  />
<p class="caption">
Figura 4.2: Pantalla de inicio con usuario logueado.
</p>
</div>
<p>Si la persona no cuenta con permisos de entrenador, se le sugiere que contacte a un administrador para que le otorgue el permiso (Figura <a href="implementation.html#fig:logic-home-logged-nontrainer">4.3</a>).</p>
<div class="figure" style="text-align: center"><span id="fig:logic-home-logged-nontrainer"></span>
<img src="assets/logic/home-logged-not_trainer.png" alt="Pantalla de inicio sin rol de entrenador."  />
<p class="caption">
Figura 4.3: Pantalla de inicio sin rol de entrenador.
</p>
</div>
<p>Si la persona visitando la página no cuenta con una sesión activa, se le invita a ingresar con una cuenta pre-existente o a registrarse (Figura <a href="implementation.html#fig:logic-home-anonymous">4.4</a>).</p>
<div class="figure" style="text-align: center"><span id="fig:logic-home-anonymous"></span>
<img src="assets/logic/home-anonymous.png" alt="Pantalla de inicio sin sesión."  />
<p class="caption">
Figura 4.4: Pantalla de inicio sin sesión.
</p>
</div>
</div>
<div id="entrenamiento" class="section level4">
<h4><span class="header-section-number">4.1.1.2</span> Entrenamiento</h4>
<p>La pantalla de entrenamiento es el núcleo de la <em>web</em> donde se entrena el modelo.</p>
<p>El usuario es presentado con un texto perteneciente al <em>corpus</em> del servicio con las entidades inferidas por el modelo actual. Con un editor especial que recibe un documento generado por <em>spaCy</em> que incluye <em>tokens</em> de palabras y entidades, le permitimos al usuario poder corregir las entidades inferidas y enviarle la corrección al servicio. Esa corrección será utilizada posteriormente a la hora de mejorar el modelo actual (Figura <a href="implementation.html#fig:logic-train">4.5</a>).</p>
<div class="figure" style="text-align: center"><span id="fig:logic-train"></span>
<img src="assets/logic/train.png" alt="Pantalla de entrenamiento."  />
<p class="caption">
Figura 4.5: Pantalla de entrenamiento.
</p>
</div>
<div id="usabilidad" class="section level5">
<h5><span class="header-section-number">4.1.1.2.1</span> Usabilidad</h5>
<p>Tuvimos un foco fuerte en la usabilidad del componente ya que los entrenadores del servicio van a pasar prácticamente todo su tiempo en ésta pantalla, por lo que se tuvieron las siguientes consideraciones en la implementación.</p>
<div id="llamado-a-acción-y-ayuda" class="section level6">
<h6><span class="header-section-number">4.1.1.2.1.1</span> Llamado a acción y ayuda</h6>
<p>Dado que lo primero que ve el usuario es un texto con etiquetas de entidad, agregamos un título que invita al usuario a realizar acciones sobre el texto. De esta manera, le mostramos las dos acciones principales realizables desde el componente de entrenamiento: Click en alguna palabra o entidad y arrastrar un conjunto de palabras para crear una entidad nueva.
Como refuerzo de este llamado a acción, agregamos un botón que al ser clickeado muestra un mensaje de ayuda con instrucciones más detalladas sobre el objetivo del entrenador y las acciones que deben de realizarse sobre el mismo (Figura <a href="implementation.html#fig:logic-train-help">4.6</a>).</p>
<div class="figure" style="text-align: center"><span id="fig:logic-train-help"></span>
<img src="assets/logic/train-help.png" alt="Ayuda del entrenador."  />
<p class="caption">
Figura 4.6: Ayuda del entrenador.
</p>
</div>
</div>
<div id="etiquetado-de-entidades" class="section level6">
<h6><span class="header-section-number">4.1.1.2.1.2</span> Etiquetado de entidades</h6>
<p>Para etiquetar entidades decidimos ofrecer dos maneras: La más sencilla es hacer click en cada palabra. La segunda, para cuando una entidad esta definida por múltiples palabras, es arrastrar el cursor entre ellas.
Dependiendo de la ubicación en la selección dentro del texto:</p>
<ul>
<li>Si no existen entidades en el texto actual, se le asigna por defecto el tipo <em>MISC</em> y se muestran el resto de los tipos para permitir cambiarlo de ser necesario.</li>
<li>Si existen entidades antes o después, se ofrece la opción de unir la palabra actual con la entidada más próxima para el lado elegido.</li>
</ul>
<div class="figure" style="text-align: center"><span id="fig:logic-train-popup"></span>
<img src="assets/logic/train-popup.png" alt="Edición de entidad."  />
<p class="caption">
Figura 4.7: Edición de entidad.
</p>
</div>
<p>Como podemos ver en la figura <a href="implementation.html#fig:logic-train-popup">4.7</a>, si el modelo infirió una entidad de manera incorrecta, ya sea por que se trata de una entidad inválida o agregó palabras de más a la etiqueta, permitimos que el usuario remueva la entidad y que después vuelva a etiquetar correctamente.</p>
</div>
<div id="optimización-en-tiempos-de-carga" class="section level6">
<h6><span class="header-section-number">4.1.1.2.1.3</span> Optimización en tiempos de carga</h6>
<p>Es esperado que un usuario entrene más de un texto, al momento de pedir un texto para mostrar, se pide el siguiente. Mediante este mecanismo de pre-carga, podemos eliminar el tiempo de espera entre texto y texto ofreciendo al usuario entrenador una experiencia completamente fluida.</p>
</div>
</div>
</div>
<div id="administración-de-usuarios" class="section level4">
<h4><span class="header-section-number">4.1.1.3</span> Administración de usuarios</h4>
<p>La pantalla de <em>Administración de usuarios</em> permite a los usuarios con el rol de administrador poder modificar los roles de todos los usuarios del sistema, borrarlos o acceder a los detalles del usuario, tal como la lista de textos entrenados (Figura <a href="implementation.html#fig:logic-user-list">4.8</a>).</p>
<div class="figure" style="text-align: center"><span id="fig:logic-user-list"></span>
<img src="assets/logic/user-list.png" alt="Administración de usuarios."  />
<p class="caption">
Figura 4.8: Administración de usuarios.
</p>
</div>
</div>
<div id="perfil-del-usuario" class="section level4">
<h4><span class="header-section-number">4.1.1.4</span> Perfil del usuario</h4>
<p>Al hacer click Perfil, el usuario con sesión activa puede ver sus entrenamientos y cambiar su contraseña (Figura <a href="implementation.html#fig:logic-user-profile">4.9</a>).</p>
<div class="figure" style="text-align: center"><span id="fig:logic-user-profile"></span>
<img src="assets/logic/user-profile.png" alt="Perfil de usuario."  />
<p class="caption">
Figura 4.9: Perfil de usuario.
</p>
</div>
<p>Los usuarios con rol administrador pueden realizar las acciones mencionadas previamente pero sobre cualquier usuario haciendo click en el nombre del en la figura <a href="implementation.html#fig:logic-user-list">4.8</a>.</p>
</div>
<div id="corpus" class="section level4">
<h4><span class="header-section-number">4.1.1.5</span> <em>Corpus</em></h4>
<p>La pantalla de <em>corpus</em> permite a un usuario con el rol de administrador realizar tareas relacionadas con el conjunto de textos ingresados en el sistema (Figura <a href="implementation.html#fig:logic-corpus-management">4.10</a>).</p>
<div class="figure" style="text-align: center"><span id="fig:logic-corpus-management"></span>
<img src="assets/logic/corpus-management.png" alt="Administración de corpus."  />
<p class="caption">
Figura 4.10: Administración de corpus.
</p>
</div>
<p>Desde aquí es posible agregar textos al <em>corpus</em> utilizando la funcionalidad de subida de archivos. Los archivos deben ser archivos con extensión <em>.txt</em> y cada línea del archivo será agregada al <em>corpus</em> como un texto individual.</p>
<p>También es posible desde aquí ver todos los textos que forman parte del <em>corpus</em> así como también poder ver los entrenamientos para cada uno de los textos. Finalmente, es posible quitar textos del <em>corpus</em> así como también eliminar correcciones a las inferencias de entidades cargados por usuarios.</p>
</div>
<div id="estado" class="section level4">
<h4><span class="header-section-number">4.1.1.6</span> Estado</h4>
<p>La pantalla de <em>Estado</em> permite a un usuario con el rol de administrador visualizar el estado de entrenamiento del <em>corpus</em> así como también realizar diversas acciones sobre los <em>workers</em> (Figura <a href="implementation.html#fig:logic-status">4.11</a>).</p>
<div class="figure" style="text-align: center"><span id="fig:logic-status"></span>
<img src="assets/logic/status.png" alt="Información de corpus y manejo de workers."  />
<p class="caption">
Figura 4.11: Información de corpus y manejo de workers.
</p>
</div>
<div id="secciones" class="section level5">
<h5><span class="header-section-number">4.1.1.6.1</span> Secciones</h5>
<div id="corpus-1" class="section level6">
<h6><span class="header-section-number">4.1.1.6.1.1</span> Corpus</h6>
<p>Es esta columna a la izquierda se puede ver rápidamente que porcentaje de el <em>corpus</em> contiene correcciones por usuarios así como también saber la cantidad total de correcciones del sistema (un texto puede tener más de una corrección por distintos usuarios) y también presenta un botón que permite al administrador ir a la pantalla de <em>Corpus</em>.</p>
</div>
<div id="crear-snapshot" class="section level6">
<h6><span class="header-section-number">4.1.1.6.1.2</span> Crear <em>snapshot</em></h6>
<p>En esta sección, el administrador puede crear un <em>snapshot</em> del estado actual de entrenamiento del modelo. Esta funcionalidad es utiil para comparar el avance del entrenamiento en diferentes momentos de la historia del mismo.</p>
<p>Cuando se crea un <em>snapshot</em> se incrementa la última versión disponible en uno y se gesta una nueva versión actual. Además existe la posibilidad de editar los posibles tipos de entidad del sistema en este momento. Como consecuencia de esto, el sistema se asegura que todo cambio de etiquetas tenga su correspondiente versión.</p>
</div>
<div id="snapshots" class="section level6">
<h6><span class="header-section-number">4.1.1.6.1.3</span> <em>Snapshots</em></h6>
<p>Sección en la cual podemos ver la lista completa de <em>snapshots</em>.
Para cada <em>snapshot</em>, se muestra cuando fue la última vez que se entrenó así como también cuantos trabajadores tiene asignados. Finalmente es posible desde aquí forzar a entrenar el modelo para ese snapshot en particular y también se presenta la opción para desentrenar, borrando el modelo guardado en el disco.</p>
<p>Cuando el sistema entrena un <em>snapshot</em> se tendrá en cuenta todos los textos que hayan sido anotados previamente a la creación del mismo.</p>
</div>
<div id="reasignar-worker" class="section level6">
<h6><span class="header-section-number">4.1.1.6.1.4</span> Reasignar <em>worker</em></h6>
<p>Sección que permite reasignar <em>workers</em> (los servicios encargados de realizar operaciones de <em>NLP</em>) para que sirvan un snapshot distinto. De esta manera se pueden servir distintas versiones del modelo de inferencia para poder realizar pruebas sobre los mismos.</p>
</div>
</div>
</div>
<div id="sandbox" class="section level4">
<h4><span class="header-section-number">4.1.1.7</span> Sandbox</h4>
<p>Se accede a la pantalla de <em>sandbox</em> desde el inicio haciendo click en el boton de “Buscar entidades”; permite a los usuarios ingresar sus textos y obtener las entidades nombradas de los mismos haciendo consultas al servicio NERd del <em>snapshot</em> actual.
Adicionalmente, si el usuario tiene el rol de entrenador, podrá corregir las entidades inferidas y agregar el texto con sus correcciones al <em>corpus</em> (Figura <a href="implementation.html#fig:logic-sandbox">4.12</a>).</p>
<div class="figure" style="text-align: center"><span id="fig:logic-sandbox"></span>
<img src="assets/logic/sandbox.png" alt="Inferencia de entidades en sandbox."  />
<p class="caption">
Figura 4.12: Inferencia de entidades en sandbox.
</p>
</div>
</div>
<div id="comparar-snapshots" class="section level4">
<h4><span class="header-section-number">4.1.1.8</span> Comparar (<em>snapshots</em>)</h4>
<p>Esta sección es accesible únicamente por administradores y permite comparar las entidades inferidas por dos <em>snapshots</em> distintos, con la opción de marcar visualmente aquellos textos cuyas entidades difieren. A su vez, si el usuario logueado tiene el permiso de entrenador, podrá corregir de manera inline los errores en la inferencia del modelo actual (Figura <a href="implementation.html#fig:logic-compare">4.13</a>).</p>
<div class="figure" style="text-align: center"><span id="fig:logic-compare"></span>
<img src="assets/logic/compare.png" alt="Comparativa de modelos."  />
<p class="caption">
Figura 4.13: Comparativa de modelos.
</p>
</div>
</div>
<div id="registración" class="section level4">
<h4><span class="header-section-number">4.1.1.9</span> Registración</h4>
<p>Sección únicamente accesible cuando no hay una sesión activa. Aquí se registran los usuarios con la opción de que el inicio de sesión persista luego de que se cierre la pestaña del navegador (Figura <a href="implementation.html#fig:logic-registration">4.14</a>).</p>
<div class="figure" style="text-align: center"><span id="fig:logic-registration"></span>
<img src="assets/logic/register.png" alt="Registración."  />
<p class="caption">
Figura 4.14: Registración.
</p>
</div>
</div>
<div id="login" class="section level4">
<h4><span class="header-section-number">4.1.1.10</span> Login</h4>
<p>Sección únicamente accesible cuando no hay una sesión activa. Aquí ingresan los usuarios al sistema con la opción de que el inicio de sesión persista luego de que se cierre la pestaña del navegador (Figura <a href="implementation.html#fig:logic-login">4.15</a>).</p>
<div class="figure" style="text-align: center"><span id="fig:logic-login"></span>
<img src="assets/logic/login.png" alt="Inicio de sesión."  />
<p class="caption">
Figura 4.15: Inicio de sesión.
</p>
</div>
</div>
<div id="barra-de-navegación" class="section level4">
<h4><span class="header-section-number">4.1.1.11</span> Barra de navegación</h4>
<p>La barra de navegación muestra distinta información dependiendo del contexto actual del sistema.</p>
<p>Cuando no hay una sesión activa, se muestran únicamente las opciones para acceder al sistema, ya sea registrándose o ingresando utilizando credenciales (Figura <a href="implementation.html#fig:logic-status-anonymous">4.16</a>).</p>
<div class="figure" style="text-align: center"><span id="fig:logic-status-anonymous"></span>
<img src="assets/logic/status-anonymous.png" alt="Usuario anónimo."  />
<p class="caption">
Figura 4.16: Usuario anónimo.
</p>
</div>
<p>Cuando hay una sesión activa el usuario cuenta con el rol de <em>USER</em> y/o de <em>TRAINER</em> pero <strong>no</strong> con el de <em>ADMIN</em>, podrá acceder únicamente a su perfil (Figura <a href="implementation.html#fig:logic-status-user">4.17</a>).</p>
<div class="figure" style="text-align: center"><span id="fig:logic-status-user"></span>
<img src="assets/logic/status-user.png" alt="Usuario regular."  />
<p class="caption">
Figura 4.17: Usuario regular.
</p>
</div>
<p>Finalmente, cuando el usuario logueado tiene el rol de <em>ADMIN</em>, tiene acceso a todas las secciones de administración del sistema (Figura (fig:logic-status-admin)).</p>
<div class="figure" style="text-align: center"><span id="fig:logic-status-admin"></span>
<img src="assets/logic/status-admin.png" alt="Usuario administrador."  />
<p class="caption">
Figura 4.18: Usuario administrador.
</p>
</div>
</div>
</div>
<div id="api" class="section level3">
<h3><span class="header-section-number">4.1.2</span> <em>API</em></h3>
<p>Para este proyecto tomamos la decisión de ofrecer una <em>API REST</em>. Dado que <em>REST</em> es un estilo de arquitectura y <strong>no un standard</strong> históricamente ha sido dificil ofrecer este tipo de servicio de una manera amena para el developer.</p>
<p>En los últimos años han surgido especificaciones bien formadas para la definición de <em>REST APIs</em>, en particular <em>The Linux Foundation</em> ha promovido que la industria utilice <em>OPEN API</em>.</p>
<p>Es por ello que toda la especificación de nuestra <em>API</em> es <em>OpenAPI 3</em> compliant.</p>
<div id="documentación" class="section level4">
<h4><span class="header-section-number">4.1.2.1</span> Documentación</h4>
<p>Para visualizar la documentación de todos los <em>endpoints</em> del <em>API</em>, es posible utilizar dos medios: <em>Swagger UI</em> y <em>ReDoc</em>. Gracias al uso de <em>OpenAPI</em> estas documentaciones han sido autogeneradas.</p>
<div id="swagger-ui" class="section level5">
<h5><span class="header-section-number">4.1.2.1.1</span> <em>Swagger UI</em></h5>
<p>La documentación provista por <em>Swagger UI</em> permite ver el detalle de cada uno de los <em>endpoints</em> del servicio así como también permite realizar consultas de prueba contra el servidor real, prestándose así como una especie de <em>sandbox</em> (Figura <a href="implementation.html#fig:logic-swagger-main">4.19</a>).</p>
<div class="figure" style="text-align: center"><span id="fig:logic-swagger-main"></span>
<img src="assets/logic/swagger-main.png" alt="Swagger UI."  />
<p class="caption">
Figura 4.19: Swagger UI.
</p>
</div>
<p>Para cada <em>endpoint</em>, la interfaz muestra que parámetros son requeridos (Figura <a href="implementation.html#fig:logic-swagger-request">4.20</a>). Así como también permite, mediante el uso del botón <em>Try it out</em>, completar esos parámetros y ejecutar el pedido al servidor, mostrando los resultados dentro de la interfaz.</p>
<div class="figure" style="text-align: center"><span id="fig:logic-swagger-request"></span>
<img src="assets/logic/swagger-request.png" alt="Ejemplo de documentación con Swagger para request."  />
<p class="caption">
Figura 4.20: Ejemplo de documentación con Swagger para request.
</p>
</div>
<p>Para las respuesta, <em>Swagger</em> muestra la forma del <em>JSON</em> de respuesta para cada <em>HTTP code</em> distinto (Figura <a href="implementation.html#fig:logic-swagger-request">4.20</a>)</p>
<div class="figure" style="text-align: center"><span id="fig:logic-swagger-responses"></span>
<img src="assets/logic/swagger-responses.png" alt="Ejemplo de documentación con Swagger para respuestas."  />
<p class="caption">
Figura 4.21: Ejemplo de documentación con Swagger para respuestas.
</p>
</div>
</div>
<div id="redoc" class="section level5">
<h5><span class="header-section-number">4.1.2.1.2</span> <em>ReDoc</em></h5>
<p><em>ReDoc</em> es una alternativa a <em>Swagger</em> para visualizar la documentación de una especificación de <em>OpenAPI</em> que presenta un diseño más moderno así como también se enfoca más en mostrar la información de manera más clara.</p>
<p>A diferencia de <em>Swagger UI</em>, <em>ReDoc</em> no permite realizar pruebas contra el servidor para el cual se está mostrando la documentación (Figura <a href="implementation.html#fig:logic-redoc-main">4.22</a>) pero ofrece una mejor experiencia de usuario a la hora de navegar la <em>API</em>.</p>
<div class="figure" style="text-align: center"><span id="fig:logic-redoc-main"></span>
<img src="assets/logic/redoc-main.png" alt="Ejemplo de documentación con ReDoc."  />
<p class="caption">
Figura 4.22: Ejemplo de documentación con ReDoc.
</p>
</div>
</div>
</div>
<div id="endpoints" class="section level4">
<h4><span class="header-section-number">4.1.2.2</span> <em>Endpoints</em></h4>
<div id="autenticación" class="section level5">
<h5><span class="header-section-number">4.1.2.2.1</span> Autenticación</h5>
<p>Rutas del API dedicadas a la autenticación de usuarios.</p>
<ul>
<li><strong>POST</strong> <code>/api/auth/register</code>
<ul>
<li>Registrar un usuario nuevo.</li>
</ul></li>
<li><strong>POST</strong> <code>/api/auth/token</code>
<ul>
<li>Genera un nuevo <em>token</em> de acceso y refresco con credenciales.</li>
<li>Utilizado para la funcionalidad de <em>login</em>.</li>
</ul></li>
<li><strong>POST</strong> <code>/api/auth/refresh</code>
<ul>
<li>Refresca el <em>token</em> de acceso.</li>
<li>Utilizado cuando un <em>token</em> de acceso caducó.</li>
</ul></li>
</ul>
</div>
<div id="usuarios" class="section level5">
<h5><span class="header-section-number">4.1.2.2.2</span> Usuarios</h5>
<p>Conjunto de operaciones relacionadas con los usuarios del sistema.</p>
<ul>
<li><strong>GET</strong> <code>/api/users</code>
<ul>
<li>Lista de usuarios existentes.</li>
<li>Separa los resultados en páginas.</li>
</ul></li>
<li><strong>GET</strong> <code>/api/users/top5</code>
<ul>
<li>Lista de los 5 usuarios con más entrenamientos.</li>
</ul></li>
<li><strong>GET</strong> <code>/api/users/me</code>
<ul>
<li>Retorna la información del usuario logueado.</li>
</ul></li>
<li><strong>PATCH</strong> <code>/api/users/me</code>
<ul>
<li>Actualiza la información del usuario logueado.</li>
</ul></li>
<li><strong>GET</strong> <code>/api/users/me/trainings</code>
<ul>
<li>Retorna los entrenamientos del usuario logueado.</li>
<li>Separa los resultados en páginas.</li>
</ul></li>
<li><strong>GET</strong> <code>/api/users/{user_id}</code>
<ul>
<li>Retorna la información del usuario especificado por <code>user_id</code>.</li>
</ul></li>
<li><strong>PATCH</strong> <code>/api/users/{user_id}</code>
<ul>
<li>Actualiza la información del usuario especificado por <code>user_id</code>.</li>
</ul></li>
<li><strong>DELETE</strong> <code>/api/users/{user_id}</code>
<ul>
<li>Borra al usuario especificado por <code>user_id</code>.</li>
</ul></li>
<li><strong>GET</strong> <code>/api/users/{user_id}/trainings</code>
<ul>
<li>Retorna los entrenamientos del usuario especificado.</li>
</ul></li>
</ul>
</div>
<div id="roles" class="section level5">
<h5><span class="header-section-number">4.1.2.2.3</span> Roles</h5>
<ul>
<li><strong>GET</strong> <code>/api/roles</code>
<ul>
<li>Retorna la lista de todos los roles asignables a usuarios del sistema.</li>
</ul></li>
</ul>
</div>
<div id="corpus-2" class="section level5">
<h5><span class="header-section-number">4.1.2.2.4</span> Corpus</h5>
<p>Rutas dedicadas a operaciones con el <em>corpus</em> del sistema.</p>
<ul>
<li><strong>GET</strong> <code>/api/corpus/{text_id}</code>
<ul>
<li>Retorna los detalles del texto especificado por <code>text_id</code>.</li>
</ul></li>
<li><strong>DELETE</strong> <code>/api/corpus/{text_id}</code>
<ul>
<li>Borra un texto especificado por <code>text_id</code> del corpus.</li>
</ul></li>
<li><strong>GET</strong> <code>/api/corpus/{text_id}/trainings</code>
<ul>
<li>Retorna la lista de entrenamientos proporcionados por los usuarios sobre las entidades en el texto.</li>
</ul></li>
<li><strong>PUT</strong> <code>/api/corpus/{text_id}/trainings</code>
<ul>
<li>Agrega un entrenamiento para el texto con id <em>text_id</em>.</li>
</ul></li>
<li><strong>POST</strong> <code>/api/corpus/upload</code>
<ul>
<li>Permite agregar textos de manera masiva al sistema.</li>
<li>Acepta una lista de archivos <code>.txt</code> donde cada línea es un texto a agregar.</li>
<li>Los archivos deben ser <code>UTF-8</code>.</li>
</ul></li>
<li><strong>GET</strong> <code>/api/corpus</code>
<ul>
<li>Lista de textos cargados en el sistema para entrenamiento.</li>
<li>Separa los resultados en páginas.</li>
</ul></li>
<li><strong>POST</strong> <code>/api/corpus</code>
<ul>
<li>Agrega un texto al sistema para entrenamiento.</li>
</ul></li>
</ul>
</div>
<div id="snapshots-1" class="section level5">
<h5><span class="header-section-number">4.1.2.2.5</span> Snapshots</h5>
<p>Conjunto de operaciones relacionadas con los snapshots y workers.</p>
<ul>
<li><strong>GET</strong> <code>/api/snapshots</code>
<ul>
<li>Listado de los snapshots disponibles.</li>
<li>Separa los resultados en páginas.</li>
</ul></li>
<li><strong>GET</strong> <code>/api/snapshots/{snapshot_id}</code>
<ul>
<li>Retorna información (tipos de entidades, fecha de creación, fecha de entrenamiento, etc.) sobre un <em>snapshot</em> específico.</li>
</ul></li>
<li><strong>DELETE</strong> <code>/api/snapshots/{snapshot_id}</code>
<ul>
<li>Borra un <em>snapshot</em> con el id especificado.</li>
</ul></li>
<li><strong>POST</strong> <code>/api/snapshots/{snapshot_id}/force-train</code>
<ul>
<li>Envía la tarea de entrenamiento a los workers que tienen el <em>snapshot</em> <code>snapshot_id</code> cargado.</li>
</ul></li>
<li><strong>POST</strong> <code>/api/snapshots/{snapshot_id}/force-untrain</code>
<ul>
<li>Envía la tarea de desentrenar a los <em>workers</em> que tienen el <em>snapshot</em>. <em>snapshot_id</em> cargado.</li>
</ul></li>
<li><strong>GET</strong> <code>/api/snapshots/current</code>
<ul>
<li>Retorna información sobre el <em>snapshot</em> actual.</li>
</ul></li>
<li><strong>PUT</strong> <code>/api/snapshots/current</code>
<ul>
<li>Crea un nuevo <em>snapshot</em> con la información provista.</li>
</ul></li>
</ul>
</div>
<div id="reconocimiento-de-entidades-nombradas" class="section level5">
<h5><span class="header-section-number">4.1.2.2.6</span> Reconocimiento de Entidades Nombradas</h5>
<p>Conjunto de operaciones relacionadas al <em>Reconocimiento de Entidades Nombradas</em></p>
<ul>
<li><strong>GET</strong> <code>/api/ner/train</code>
<ul>
<li>Retorna un texto para que un usuario del sistema revise si está correctamente inferido.</li>
<li>Únicamente retorna textos que el usuario logueado no haya corregido ya</li>
</ul></li>
<li><strong>GET</strong> <code>/api/ner/compare/{first_snapshot}/{second_snapshot}</code>
<ul>
<li>Compara el <em>NER</em> entre dos <em>snapshots</em> distintos.</li>
</ul></li>
<li><strong>POST</strong> <code>/api/ner/current/parse</code>
<ul>
<li>Retorna un documento <em>spaCy</em> para un texto dado utilizando el <em>snapshot</em> actual.</li>
</ul></li>
<li><strong>POST</strong> <code>/api/ner/{snapshot_id}/parse</code>
<ul>
<li>Retorna un documento <em>spaCy</em> para un texto dado utilizando el <em>snapshot</em> especificado.</li>
</ul></li>
<li><strong>POST</strong> <code>/api/ner/current/entities</code>
<ul>
<li>Retorna la lista de <em>Entidades Nombradas</em> para un texto dado utilizando el modelo actual.</li>
</ul></li>
<li><strong>POST</strong> <code>/api/ner/{snapshot_id}/entities</code>
<ul>
<li>Retorna la lista de <em>Entidades Nombradas</em> para un texto dado utilizando el modelo especificado.</li>
</ul></li>
</ul>
</div>
<div id="entrenamientos" class="section level5">
<h5><span class="header-section-number">4.1.2.2.7</span> Entrenamientos</h5>
<ul>
<li><strong>DELETE</strong> <code>/api/trainings/{training_id}</code>
<ul>
<li>Borra un entrenamiento.</li>
</ul></li>
</ul>
</div>
<div id="workers" class="section level5">
<h5><span class="header-section-number">4.1.2.2.8</span> Workers</h5>
<ul>
<li><strong>GET</strong> <code>/api/workers/</code>
<ul>
<li>Lista de los workers disponibles.</li>
</ul></li>
<li><strong>POST</strong> <code>/api/workers/reassign</code>
<ul>
<li>Reasigna un trabajador de un a versión de <em>snapshot</em> a otra.</li>
</ul></li>
</ul>
</div>
</div>
</div>
</div>
<div id="vista-de-proceso" class="section level2">
<h2><span class="header-section-number">4.2</span> Vista de proceso</h2>
<blockquote>
<p>La vista de proceso trata los aspectos dinámicos del sistema, explica los procesos del sistema y cómo se comunican, y se centra en el comportamiento del sistema en tiempo de ejecución.
La vista de proceso aborda concurrencia, distribución, integradores, rendimiento y escalabilidad, etc.</p>
</blockquote>
<p>Como podemos ver en la figura <a href="implementation.html#fig:process-overview-client">4.23</a>, existen cinco tipos de proceso que juntos forman la totalidad de NERd y su entrenador.</p>
<p>Para la implementación de cada una de las partes tuvimos como primer objetivo lograr el desarrollo de un proyecto que pudiera escalar horizontalmente desde su concepción, es por ello que separamos cada parte del proyecto para poder lograr una arquitectura que escale naturalmente.</p>
<div class="figure" style="text-align: center"><span id="fig:process-overview-client"></span>
<img src="assets/process/process-overview-client.png" alt="Componentes del sistema."  />
<p class="caption">
Figura 4.23: Componentes del sistema.
</p>
</div>
<div id="cliente-web" class="section level3">
<h3><span class="header-section-number">4.2.1</span> Cliente web</h3>
<p>Es la interfaz del entrenador que se comunica con el API utilizando un <em>SDK</em> auto-generado a partir de la definición de <em>OpenAPI</em>. Implementado en este proyecto es un cliente <em>web</em> el cual permite explotar las funcionalidades de entrenamiento así como de inferencia de entidades.</p>
</div>
<div id="api-1" class="section level3">
<h3><span class="header-section-number">4.2.2</span> <em>API</em></h3>
<p>Servicio en el cual los clientes pueden pedir las <em>Entidades Nombradas</em> de textos así como también permite la carga de textos con sus respectivas correcciones que luego serán utilizadas para entrenar el modelo de inferencia.
El <em>API</em> se comunica el servicio de <em>Bases de Datos</em> para obtener o modificar información sobre los usuarios, los textos pertenecientes al <em>corpus</em> o información de los distintos <em>snapshots</em> y envía mensajes al <em>Task Scheduler</em> para realizar diversas tareas relacionadas con <em>spaCy</em> así como también tareas de administración sobre los <em>workers</em> disponibles.</p>
<p>Debido a que la <em>API</em> está implementada en <em>python</em> y este es un lenguaje cuyo intérprete posee un <em>lock</em> global <span class="citation">(“Python,” <a href="#ref-python_gil">2019</a>)</span>, debimos implementar la aplicación como un servicio que implementa <em>WSGI</em> <span class="citation">(Eby, <a href="#ref-pep-3333">2010</a>)</span>. Luego la aplicación es servida por <em>gunicorn</em>, un <em>application server</em> para este fin que escala horizontalmente su <em>pool</em> de <em>workers</em>.</p>
</div>
<div id="worker" class="section level3">
<h3><span class="header-section-number">4.2.3</span> Worker</h3>
<p>Un <em>worker</em> se encarga de realizar las operaciones de <em>NER</em> incluyendo el entrenamiento de modelos de inferencia. Es un servicio que existe de manera independiente.</p>
<p>El modelo estadístico debe ser cargado en memoria para poder ser utilizado. El mismo requiere de muchos recursos y tiene una eficiencia limitada ya que puede atender una sóla consulta a la vez. Es por ello que decidimos, en lugar de que el modelo sea parte de la <em>API</em> resultando en un cuello de botella, encapsular el modelo en un servicio externo para que pueda ser escalado horizontalmente.</p>
<p>Como el <em>worker</em> es una unidad de trabajo que recibe tareas desde el <em>task scheduler</em>, es posible tener varios <em>workers</em> donde cada uno utiliza un modelo de inferencia distinto (generados a partir de distintos <em>snapshots</em>).</p>
<p>Cuando un <em>worker</em> es creado, automáticamente carga el modelo actual (<em>snapshot</em> actual) y se suscribe a la cola de mensajes para esa versión en particular.</p>
<div id="entrenamiento-y-carga-de-snapshots" class="section level4">
<h4><span class="header-section-number">4.2.3.1</span> Entrenamiento y carga de snapshots</h4>
<p>Dado que pueden haber varios <em>workers</em> utilizando el mismo modelo de <em>spaCy</em>, es de vital importancia que si existe al menos un <em>worker</em> leyendo un modelo desde el disco y otro worker quiere entrenar ese modelo, que no pueda hasta que el resto haya terminado de leerlo.
Ésto se debe a que si el <em>worker</em> que está entrenando el modelo sobreescribe los archivos del disco mientras otro los está leyendo, va a llevar a llevar a la falla del <em>worker</em> de lectura. Como no hay ninguna limitación en la lectura, más de un <em>worker</em> puede leer en simultáneo.</p>
<p>Para realizar ese control de concurrencia utilizamos el campo <code>semaphore</code> del modelo de <em>snapshot</em> guardado en la base de datos (Figura <a href="implementation.html#fig:developer-db-snapshot">4.35</a>) el cual usualmente se encuentra en <span class="math inline">\(0\)</span>. El semáforo es incrementado en uno cuando un worker comienza a leer o termina de entrenar el modelo; es decrementado en uno cuando termina de leer o comienza a entrenar el modelo. Con esas cuatro acciones es posible controlar la correcta lectura/escritura del modelo desde el disco en un entorno distribuido sin causar problemas de concurrencia.</p>
<p>En la figura <a href="implementation.html#fig:scenarios-worker-train">4.24</a> podemos ver un escenario en el que tanto <em>Worker 2</em> y <em>Worker 3</em> pueden leer en simultáneo el modelo pero <em>Worker 1</em> debe quedarse esperando hasta que el semáforo vuelva a cero (nadie leyendo o entrenando el modelo) para poder realizar la tarea de entrenamiento.</p>
<div class="figure" style="text-align: center"><span id="fig:scenarios-worker-train"></span>
<img src="assets/mermaid/scenarios-worker-train.png" alt="Bloqueo de entrenamiento por lectura."  />
<p class="caption">
Figura 4.24: Bloqueo de entrenamiento por lectura.
</p>
</div>
</div>
</div>
<div id="task-scheduler" class="section level3">
<h3><span class="header-section-number">4.2.4</span> Task Scheduler</h3>
<p>Recibe tareas desde el <em>API</em> tales como reconocer entidades, entrenar y desentrenar un modelo, cambiar el modelo de un worker entre otras. A el task scheduler se suscriben todos los <em>workers</em> del sistema de manera tal de poder recibir mensajes y realizar acciones.
Su funcionamiento es crítico para poder manejar grandes volúmenes de consultas al motor de inferencia ya que permite generar una estructura que escale horizontalmente debido a la posibilidad de contar con la suscripción de un número arbitrario de <em>workers</em>.</p>
<p>Este proceso escala horizontalmente debido a que su implementación en la capa física es un <em>cluster</em>.</p>
</div>
<div id="base-de-datos" class="section level3">
<h3><span class="header-section-number">4.2.5</span> Base de datos</h3>
<p>Servicio que contiene la base de datos con la información necesaria (usuarios, snapshots) para que el servicio de <em>API</em> funcione así como también los datos necesarios por los workers (entrenamientos).</p>
<p>Este proceso escala horizontalmente debido a que su implementación en la capa física es un <em>cluster</em>.</p>
<div id="autenticación-1" class="section level4">
<h4><span class="header-section-number">4.2.5.1</span> Autenticación</h4>
<p>El proceso de autenticación de la <em>API</em> sigue el flujo de <em>OAuth2</em> <span class="citation">(Group, <a href="#ref-oauth2">2017</a>)</span>, debido a como está definido, el usuario al autenticarse con <em>email</em> y <em>password</em> recibe par de identificadores únicos llamados <code>access_token</code> y <code>refresh_token</code>. A partir de este momento todos los requests del usuario a la <em>API</em> poseen en su encabezado el <code>access_token</code>. Ocurre que estos <em>tokens</em> de acceso son sólo válidos por un tiempo limitado (en nuestra implementación ese tiempo es de 15 minutos). Debido a eso, es necesario refrescar el <code>access_token</code> utilizando el <code>refresh_token</code> provisto en el <em>login</em> inicial. Al hacer esto el usuario recibe un nuevo par de <em>tokens</em> de igual manera a como lo hizo en el <em>login</em> con sus credenciales.</p>
<p>De esta manera se mejora la seguridad del sistema dado que el usuario sólo necesita enviarle al backend <strong>una sola vez</strong> sus credenciales sensibles.</p>
<p>En la figura <a href="implementation.html#fig:scenarios-relogin">4.25</a> podemos ver el flujo que realiza la implementación <em>web</em> del entrenador para realizar el refresco de la sesión al recibir un <span class="math inline">\(401\)</span> por parte del servidor.</p>
<div class="figure" style="text-align: center"><span id="fig:scenarios-relogin"></span>
<img src="assets/mermaid/scenarios-relogin.png" alt="Flujo de relogin"  />
<p class="caption">
Figura 4.25: Flujo de relogin
</p>
</div>
</div>
</div>
</div>
<div id="vista-de-desarrollo" class="section level2">
<h2><span class="header-section-number">4.3</span> Vista de desarrollo</h2>
<blockquote>
<p>La vista de desarrollo ilustra un sistema desde la perspectiva de un programador y se ocupa de la gestión de software.
Esta vista también se conoce como la vista de implementación.</p>
</blockquote>
<div id="cliente-web-1" class="section level3">
<h3><span class="header-section-number">4.3.1</span> Cliente web</h3>
<p>La página <em>web</em> que contiene la interfaz de administración así como también la de entrenamiento. Para implementarla decidimos utilizar el modelo de <em>Single Page Application</em> que nos permitió generar un <em>bundle</em> que puede ser hosteado en <em>CDNs</em> y nos permite tener ciclos de release independientes al los del servicio.</p>
<p>Poder separar las <em>releases</em> de la <em>web</em> y el servicio es importante ya que los clientes del servicio no necesariamente necesitan de la web, ya que pueden acceder al servicio mediante el <em>API REST</em> y una baja por cambios a la interfaz de la <em>web</em> no afecta la disponibilidad del servicio.</p>
<div id="tecnologías" class="section level4">
<h4><span class="header-section-number">4.3.1.1</span> Tecnologías</h4>
<p>Para la implementación utilizamos el lenguaje de programación llamado <strong>Typescript</strong> <span class="citation">(“Typescript,” <a href="#ref-typescript">2019</a>)</span>, lenguaje desarrollado por <em>Microsoft</em> que compila a <em>JavaScript</em> con el agregado de <em>Tipos</em> que permiten producir código de mayor calidad debido al agregado de la posibilidad del chequeo estático de código para validar su correctitud.</p>
<p>Una vez definido el lenguaje, optamos por utilizar la librería llamada <strong>ReactJS</strong> <span class="citation">(Facebook, <a href="#ref-react">2019</a>)</span> desarrollada por <em>Facebook</em> para implementar la interfaz.</p>
<p>Sumado a <strong>ReactJS</strong>, incluímos diversas librerías para poder resolver varios problemas en el desarrollo de una <em>SPA</em>:</p>
<div id="material-ui" class="section level5">
<h5><span class="header-section-number">4.3.1.1.1</span> Material UI</h5>
<p>Provee de una biblioteca de componentes estilados siguiendo el patrón de diseño propuesto por <em>Google</em> llamado <em>Material Design</em>.</p>
</div>
<div id="react-router" class="section level5">
<h5><span class="header-section-number">4.3.1.1.2</span> React Router</h5>
<p>Desarrollada por <em>React Training</em>, proveé de mecanimos para la navegación en <em>SPAs</em>.</p>
</div>
<div id="i18next" class="section level5">
<h5><span class="header-section-number">4.3.1.1.3</span> i18next</h5>
<p>Librería que proveé mecanismos de internacionalización. A su vez, nos permitió generar los archivos de traducción mediante su extracción del código fuente utilizando la herramienta <code>i18next-scanner</code>.</p>
</div>
<div id="openapi-generator" class="section level5">
<h5><span class="header-section-number">4.3.1.1.4</span> OpenAPI Generator</h5>
<p><em>OpenAPI Generator</em> es una herramienta que permite generar código a partir de una definición de <em>OpenAPI</em>.
Debido a que el servicio implementado expone una definiciión de <em>OpenAPI</em>, podemos utilizar ésta librería para auto-generar todo el código necesario para comunicarnos con el servicio usando el generador de <em>Typescript</em>.</p>
</div>
</div>
<div id="arquitectura" class="section level4">
<h4><span class="header-section-number">4.3.1.2</span> Arquitectura</h4>
<p>El código en la <em>web</em> se encuentra separado por funcionalidad, ya sean de utilidad, como modelos o funciones, o de funcionalidad, como la vista de la pantalla de inicio (Figura <a href="implementation.html#fig:developer-web-modules">4.26</a>).</p>
<div class="figure" style="text-align: center"><span id="fig:developer-web-modules"></span>
<img src="assets/developer/web-modules.png" alt="Módulos de la página web."  />
<p class="caption">
Figura 4.26: Módulos de la página web.
</p>
</div>
<p>Los módulos marcados en azul son relacionados al contenido que se muestra cada ruta del sistema.</p>
<p>Los módulos marcados en rojo son de utilidad, ya sea por que contienen todo el código relevante a la comunicación con el <em>API REST</em> o a componentes utilizados en varias áreas de los módulos azules.</p>
</div>
<div id="sesión" class="section level4">
<h4><span class="header-section-number">4.3.1.3</span> Sesión</h4>
<p>El servicio <em>web</em> ofrece la posibilidad de recordar la sesión de un usuario en el momento de realizar el login. De elegirse, las credenciales son guardadas en el <em>local storage</em> del cliente web, de manera tal que el usuario pueda utilizar la misma sesión por más de que haya cerrado el cliente web.</p>
<p>Si en algún momento en el futuro el <em>API</em> nos retorna algún request indicando que el usuario no tiene permisos para acceder a algún área (código <code>HTTP 401</code>) y el <em>token</em> de refrescado dejó de ser válido, las credenciales se borran del <em>local storage</em> y redirigimos al cliente a la pantalla de inicio.</p>
<p>Ofrecemos también la posibilidad de no guardar la sesión, lo cual hará que una vez cerrada la pestaña, el usuario deba volver a ingresar al sistema para poder acceder a los distintos servicios.</p>
</div>
<div id="internacionalización" class="section level4">
<h4><span class="header-section-number">4.3.1.4</span> Internacionalización</h4>
<p>Así como las credenciales, las preferencias de internacionalización son guardadas en el <em>local storage</em> del cliente web, de manera tal que los usuarios del sistema no deban elegir el idioma de su preferencia cada vez que ingresan a la página.</p>
</div>
</div>
<div id="api-2" class="section level3">
<h3><span class="header-section-number">4.3.2</span> <em>API</em></h3>
<p>Implementada utilizando el lenguaje de programación <em>Python</em>. El principal motivador de esta elección fue que las librerías que más se acercan al estado del arte en <em>Machine Learning</em> se encuentran implementadas en este lenguaje. Provee del servicio al cual acceden los usuarios, tales como la plataforma <em>web</em> de entrenamiento mediante la implementación de un <em>API</em> <em>REST</em>.</p>
<div id="tecnologías-1" class="section level4">
<h4><span class="header-section-number">4.3.2.1</span> Tecnologías</h4>
<div id="flask" class="section level5">
<h5><span class="header-section-number">4.3.2.1.1</span> <em>Flask</em></h5>
<p>Como base del proyecto utilizamos un <em>microframework</em> de aplicaciones <em>web</em> llamado <em>Flask</em> <span class="citation">(“Flask,” <a href="#ref-flask">2019</a>)</span> ya que por diseño utiliza pocos recursos. Por defecto no incluye ninguna solución para comunicarse con una base de datos, ni lógica para validar formularios.</p>
</div>
<div id="flask-smorest" class="section level5">
<h5><span class="header-section-number">4.3.2.1.2</span> <em>flask-smorest</em></h5>
<p><em>Framework</em> que enriquece a <em>Flask</em> agregando la posibilidad de poder crear <em>APIs REST</em> generando una especificación de <em>OpenAPI</em> que es expuesta a los usuarios del servicio en dos variantes de documentación: <em>ReDoc</em> y <em>Swagger UI</em>. Tener un <em>API</em> que se auto-documenta nos permite ofrecerle a los clientes un lugar en el cual puedan consultar el funcionamiento completo de el servicio requiriendo poco trabajo extra a la hora de desarrollar el servicio.</p>
<p>A su vez, provee facilidades de serialización y de-serialización de objetos en respuestas <em>JSON</em> utilizando la librería de <em>marshmallow</em> así como también utilizades para simplificar la creación de <em>endpoints</em> que permitan paginar sus resultados (particularmente útil para listar entidades como entrenamientos, usuarios o textos).</p>
</div>
<div id="flask-jwt-extended" class="section level5">
<h5><span class="header-section-number">4.3.2.1.3</span> <em>flask-jwt-extended</em></h5>
<p><em>Flask JWT extended</em> es una librería que agrega a <em>Flask</em> la funcionalidad de poder restringir el acceso a ciertos <em>endpoints</em> requiriendo que el usuario tenga un <em>JSON Web Token</em> <span class="citation">(Jones, Bradley, Sakimura, NRI, &amp; Microsoft, <a href="#ref-JWT">2015</a>)</span> que acredite su identidad. A su vez, dado que cada <em>token</em> se asocia a una identidad (usuario) y es capaz de contener información, podemos utilizar el mismo sistema para guardar los roles del usuario y requerir que cuente con los permisos necesarios.</p>
</div>
<div id="mongoengine" class="section level5">
<h5><span class="header-section-number">4.3.2.1.4</span> <em>Mongoengine</em></h5>
<p><em>Mongoengine</em> es una librería pensada para trabajar con <em>MongoDB</em> en <em>Python</em>. En su esencia es un <em>Document-Object Mapper</em> que permite convertir resultados de consultas de la base de datos en objetos de <em>Python</em> así como también permite guardar esos objetos en la base de datos.</p>
</div>
<div id="marshmallow-mongoengine" class="section level5">
<h5><span class="header-section-number">4.3.2.1.5</span> <em>marshmallow-mongoengine</em></h5>
<p>Librería que nos permite integrar la librería de serialización <em>Marshmallow</em> con <em>Mongoengine</em> simplificando el manejo de objetos entre la base de datos y los objetos que se serializan o deserializan en la capa del <em>API</em>. Es de especial utilidad la posibilidad de excluir campos a serializar ya que permite retornar únicamente lo que es de interés para el usuario, como por ejemplo sucede al retornar un objeto <em>User</em> ya nunca deberíamos devolver en una respuesta el campo <em>password</em> de la base de datos.</p>
</div>
</div>
</div>
<div id="worker-1" class="section level3">
<h3><span class="header-section-number">4.3.3</span> Worker</h3>
<p>El proceso de <em>worker</em> fue implementado en <em>Python</em> utilizando la librería <em>Celery</em>.</p>
<p>Por diseño, los <em>workers</em> siempre tienen un modelo de inferencia cargado en memoria, por lo que cuando se crea uno nuevo se le asigna por defecto el <em>snapshot</em> actual (<code>snapshot_id = 0</code>) para poder ayudar a distribuir la carga de los pedidos al <em>API</em>.</p>
<p>Debido a que requieren de un <em>snapshot</em> para poder realizar la tarea de <em>NER</em> así como también requieren del <em>corpus</em> anotado para poder entrenar el modelo, cada <em>worker</em> debe tener acceso a la base de datos principal de <em>NERd</em> (Figura <a href="implementation.html#fig:process-overview-client">4.23</a>).</p>
<p>Cada <em>worker</em> puede realizar las siguientes tareas:</p>
<ul>
<li><strong>train</strong>: Entrenar el modelo de inferencia de <em>spaCy</em> utilizando el <em>snapshot</em> para el cual fue configurado.</li>
<li><strong>un_train</strong>: Borra el modelo guardado en el disco, efectivamente “des-entrenandose”. Principalmente utilizado para liberar recursos.</li>
<li><strong>reload</strong>: Recarga el modelo de inferencia desde el disco. Utilizado cuando algún <em>worker</em> entrenó el modelo y el actual quedó desactualizado.</li>
<li><strong>nlp</strong>: Realiza la tarea de <em>NER</em> utilizando el modelo cargado.</li>
<li><strong>change_snapshot</strong>: Cambia el <em>snapshot</em> utilizado en el <em>worker</em>.</li>
</ul>
</div>
<div id="task-scheduler-1" class="section level3">
<h3><span class="header-section-number">4.3.4</span> <em>Task Scheduler</em></h3>
<p>El <em>task scheduler</em> que utilizamos en el <em>API</em> para poder orquestar todas las tareas relacionadas con <em>NER</em> así como también la de la administración de los <em>workers</em> es <em>Celery</em> <span class="citation">(“Celery,” <a href="#ref-celery">2019</a>)</span>. <em>Celery</em> es una cola de tareas asincrónica especializada en procesamiento distribuido.
Si bien soporta distintos <em>backends</em> para la funcionalidad de cola de mensajes, decidimos utilizar <em>RabbitMQ</em> <span class="citation">(“RabbitMQ,” <a href="#ref-rabbitmq">2019</a>)</span> debido a su robustez y la posibilidad de escalar horizontalmente.</p>
<p>Para el monitoreo de las tareas de <em>Celery</em> utilizamos la herramienta llamada <em>Flower</em> <span class="citation">(Movsisyan, <a href="#ref-flower">2016</a>)</span>, que permite consultar el estado de cada worker (Figura <a href="implementation.html#fig:developer-flower-dashboard">4.27</a>), historial de tareas (Figura <a href="implementation.html#fig:developer-flower-task-history">4.28</a>) así como también estadísticas en tiempo real sobre el sistema (Figura <a href="implementation.html#fig:developer-flower-monitoring">4.29</a>) y detalles de todos los <em>workers</em> que están conectados a la cola de mensajes (Figura <a href="implementation.html#fig:developer-flower-monitoring">4.29</a>).</p>
<div class="figure" style="text-align: center"><span id="fig:developer-flower-dashboard"></span>
<img src="assets/developer/flower-dashboard.png" alt="Página principal de Flower."  />
<p class="caption">
Figura 4.27: Página principal de Flower.
</p>
</div>
<div class="figure" style="text-align: center"><span id="fig:developer-flower-task-history"></span>
<img src="assets/developer/flower-task-history.png" alt="Historial de tareas en Flower."  />
<p class="caption">
Figura 4.28: Historial de tareas en Flower.
</p>
</div>
<div class="figure" style="text-align: center"><span id="fig:developer-flower-monitoring"></span>
<img src="assets/developer/flower-monitoring.png" alt="Monitoreo en tiempo real en Flower."  />
<p class="caption">
Figura 4.29: Monitoreo en tiempo real en Flower.
</p>
</div>
<div class="figure" style="text-align: center"><span id="fig:developer-flower-broker"></span>
<img src="assets/developer/flower-broker.png" alt="Listado de colas activas en Flower."  />
<p class="caption">
Figura 4.30: Listado de colas activas en Flower.
</p>
</div>
<div class="figure" style="text-align: center"><span id="fig:developer-flower-worker-queues"></span>
<img src="assets/developer/flower-worker-queues.png" alt="Colas de mensaje escuchadas por un worker."  />
<p class="caption">
Figura 4.31: Colas de mensaje escuchadas por un worker.
</p>
</div>
</div>
<div id="MongoDBDev" class="section level3">
<h3><span class="header-section-number">4.3.5</span> Base de Datos</h3>
<p>Debido a que en el proyecto necesitamos guardar mayormente documentos (entrenamientos), optamos por utilizar una base de datos orientada a documentos: <em>MongoDB</em> <span class="citation">(“MongoDB,” <a href="#ref-mongodb">2019</a>)</span>.</p>
<p><em>MongoDB</em> nos permite tener un lugar en donde guardar todos los documentos que puede escalar tanto como sea necesario debido a su posibilidad de fragmentar<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> o replicar<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a> información entre distintas instancias que pueden estar ubicadas en distintos servidores.</p>
<div id="modelado" class="section level4">
<h4><span class="header-section-number">4.3.5.1</span> Modelado</h4>
<p>Para el modelado de los datos utilizamos cuatro colecciones mostradas en la figura <a href="implementation.html#fig:developer-db-overview">4.32</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:developer-db-overview"></span>
<img src="assets/developer/db-overview.png" alt="Colecciones de la base de datos."  />
<p class="caption">
Figura 4.32: Colecciones de la base de datos.
</p>
</div>
<div id="user" class="section level5">
<h5><span class="header-section-number">4.3.5.1.1</span> <em>User</em></h5>
<p>La colección <em>user</em> contiene la información de todos los usuarios del sistema (Figura <a href="implementation.html#fig:developer-db-user">4.33</a>). Entre los datos del usuario está el campo <em>trainings</em>, que guarda internamente una lista de <em>ObjectId</em> pertenecientes a los entrenamientos del usuario. A su vez está la lista de roles a los cuales tiene acceso el usuario.</p>
<div class="figure" style="text-align: center"><span id="fig:developer-db-user"></span>
<img src="assets/developer/db-user.png" alt="Colección de usuarios."  />
<p class="caption">
Figura 4.33: Colección de usuarios.
</p>
</div>
</div>
<div id="text" class="section level5">
<h5><span class="header-section-number">4.3.5.1.2</span> <em>Text</em></h5>
<p>La colección <em>text</em> contiene todos los textos que forman parte del corpus que son cargados para ser mostrados en la interfaz de entrenamiento (Figura <a href="implementation.html#fig:developer-db-text">4.34</a>). Así como <em>user</em>, cada documento de <em>text</em> contiene una lista de referencias a los entrenamientos para ese texto.</p>
<div class="figure" style="text-align: center"><span id="fig:developer-db-text"></span>
<img src="assets/developer/db-text.png" alt="Colección de textos."  />
<p class="caption">
Figura 4.34: Colección de textos.
</p>
</div>
</div>
<div id="snapshot" class="section level5">
<h5><span class="header-section-number">4.3.5.1.3</span> <em>Snapshot</em></h5>
<p>La colección <em>snapshot</em> contiene información sobre los distintos <em>snapshots</em> creados en el sistema (Figura <a href="implementation.html#fig:developer-db-snapshot">4.35</a>). De particular interés es el atributo <em>types</em>, que contiene un mapa de todos los tipos de entidades disponibles en el <em>snapshot</em>. También contiene el atributo <em>semaphore</em>, que sirve como un campo de control para poder organizar a los <em>workers</em> que están utilizando ese <em>snapshot</em> en particular.</p>
<div class="figure" style="text-align: center"><span id="fig:developer-db-snapshot"></span>
<img src="assets/developer/db-snapshot.png" alt="Colección de snapshots."  />
<p class="caption">
Figura 4.35: Colección de snapshots.
</p>
</div>
</div>
<div id="training" class="section level5">
<h5><span class="header-section-number">4.3.5.1.4</span> <em>Training</em></h5>
<p>La colección <em>training</em> contiene información sobre todos los entrenamientos cargados en el sistema (Figura <a href="implementation.html#fig:developer-db-training">4.36</a>). Cada entrenamiento contiene referencia al texto al que pertenece así como también al usuario que lo creó. De manera tal de poder obtener la información de los documentos relacionados sin necesidad de duplicar información.</p>
<p>Dentro de un documento <em>training</em>, se encuentra el atributo <em>document</em>, que es el que internamente contiene la representación de un documento de entrenamiento que es entendido por <em>spaCy</em> y que luego será utilizado para entrenar el modelo de inferencia.</p>
<div class="figure" style="text-align: center"><span id="fig:developer-db-training"></span>
<img src="assets/developer/db-training.png" alt="Colección de entrenamientos."  />
<p class="caption">
Figura 4.36: Colección de entrenamientos.
</p>
</div>
<!-- Utiliza el diagrama de componentes UML para describir los componentes del sistema. -->
<!-- Los diagramas UML utilizados para representar la vista de desarrollo incluyen el diagrama del paquete. -->
<!-- TODO: explicar implementación de software ui y backend. Python, React, etc.-->
<!-- TODO: Hablar sobre Atributos de calidad de software -->
</div>
</div>
</div>
</div>
<div id="vista-física" class="section level2">
<h2><span class="header-section-number">4.4</span> Vista física</h2>
<blockquote>
<p>La vista física representa el sistema desde el punto de vista de un ingeniero de sistemas.
Se refiere a la topología de los componentes de software en la capa física, así como a las conexiones físicas entre estos componentes.
Esta vista también se conoce como la vista de <em>deployment</em>.</p>
</blockquote>
<div id="docker" class="section level3">
<h3><span class="header-section-number">4.4.1</span> <em>Docker</em></h3>
<p><em>Docker</em> <span class="citation">(“Docker,” <a href="#ref-docker">2019</a>)</span> es un conjunto de productos que permiten empaquetar aplicaciones en contenedores. Cada contenedor contiene todo lo necesario para que la aplicación funcione (código, dependencias, configuraciones, herramientas del sistema, etc.)<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>. Mediante el uso de virtualización, es posible distribuir y ejecutar un contenedor en más de un sistema, lo que lleva a la posibilidad de tener varias réplicas de un mismo servicio ejecutando al mismo tiempo.</p>
<p>Por ésta razón decidimos utilizar <em>Docker</em> como la herramienta para empaquetar los servicios principales de <em>NERd</em>.</p>
<p>La implementación completa de <em>NERd</em> está formada por 5 contenedores requeridos y uno opcional:</p>
<ul>
<li><strong>ui</strong>: servidor <em>web</em> de la página de administración y entrenamiento.</li>
<li><strong>app</strong>: servidor de aplicaciones web de la <em>API</em>.</li>
<li><strong>worker</strong>: servicio de <em>NER</em>. (escalable)</li>
<li><strong>rabbitmq</strong>: cola de mensajes.</li>
<li><strong>flower</strong>: servicio de monitoreo de <em>RabbitMQ</em> (opcional).</li>
<li><strong>mongodb</strong>: base de datos.</li>
</ul>
</div>
<div id="deployment" class="section level3">
<h3><span class="header-section-number">4.4.2</span> Deployment</h3>
<div id="docker-images" class="section level4">
<h4><span class="header-section-number">4.4.2.1</span> <em>Docker images</em></h4>
<p>Para realizar un <em>deployment</em> de nuevas versiones de cada contenedor de docker, existen comandos dentro del archivo <code>Makefile</code>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="fu">make</span> build <span class="co"># Construye nuevas imágenes para cada uno de los servicios</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="fu">make</span> release-push <span class="co"># Publica las nuevas imágenes a github</span></a></code></pre></div>
<p>Las imágenes base que utilizamos en todos los servicios son mantenidas por <em>Bitnami</em> <span class="citation">(“Bitnami,” <a href="#ref-bitnami">2019</a>)</span>. Tomamos esta decisión para:
1. Reducir el tamaño de las imágenes al reutilizar la capa de sistema operativo entre todas ellas.
2. Se actualizan automáticamente con todos los parches de seguridad de las plataformas elegidas.
3. Están implementadas siguiendo las mejores prácticas acerca del no uso de <em>root</em> en containers.</p>
</div>
<div id="service" class="section level4">
<h4><span class="header-section-number">4.4.2.2</span> <em>Service</em></h4>
<p>Para poder crear un entorno completo de <em>NERd</em>, utilizamos la herramienta llamada <code>docker-compose</code> <span class="citation">(“Docker compose,” <a href="#ref-dockercompose">2019</a>)</span>, con la cual definimos cada uno de los servicios, las conexiones de red y los volúmenes de disco necesarias entre cada contenedor de manera tal que las conexiones mostradas en la figura <a href="implementation.html#fig:process-overview-client">4.23</a> funcionen correctamente.</p>
<p>A su vez, dentro de un archivo <em>Makefile</em> del proyecto definimos un conjunto de comandos que sirven para crear un entorno de desarrollo de <em>NERd</em>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="fu">make</span> setup <span class="co"># Inicializa todos los contenedores de NERd, creando 2 workers</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="fu">make</span> down <span class="co"># Destruye todos los contenedores de NERd</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="fu">make</span> stop <span class="co"># Apaga los contenedores de NERd (sirve liberar recursos en una máquina)</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="fu">make</span> start <span class="co"># Enciende los contenedores parados de NERd</span></a></code></pre></div>
<p>Para realizar un <em>deploy</em> de la aplicación en un entorno productivo utilizaremos de ejemplo utilizando el servidor provisto por el <em>ITBA</em>.</p>
<p>Primero es necesario contar con una configuración de <em>SSH</em> que defina el <em>host</em> <em>pf-nerd</em>:</p>
<pre class="sshconfig"><code>Host pampero
    Hostname pampero.itba.edu.ar
    User &lt;ITBA_USER&gt;

Host pf-nerd
    Hostname &lt;MACHINE_IP&gt;
    User &lt;MACHINE_USER&gt;
     # Requerimos un proxy para acceder a pampero
    ProxyCommand ssh pampero nc %h %p
    ControlMaster auto
    ControlPath ~/.ssh/sockets/%r@%h-%p
    ControlPersist 600</code></pre>
<p>Con esa configuración en el archivo <code>~/.ssh/config</code> podemos ejecutar el comando para realizar el <em>setup</em> de una instancia con las configuraciones de producción.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="fu">make</span> prod-setup</a></code></pre></div>
</div>
</div>
<div id="servicios" class="section level3">
<h3><span class="header-section-number">4.4.3</span> Servicios</h3>
<div id="cliente-web-2" class="section level4">
<h4><span class="header-section-number">4.4.3.1</span> Cliente <em>web</em></h4>
<p>Dentro del <em>container</em> <code>ui</code>, incluimos <em>nginx</em> <span class="citation">(“Nginx,” <a href="#ref-nginx">2019</a>)</span> como servidor <em>web</em> de la plataforma. El mismo tiene dos responsabilidades:</p>
<ol style="list-style-type: decimal">
<li>Servir el contenido estático de la <em>SPA</em>.</li>
<li>Redirigir los <em>requests</em> de las urls que comienzan con <code>/api/</code> al container de <em>API</em>.</li>
</ol>
</div>
<div id="api-3" class="section level4">
<h4><span class="header-section-number">4.4.3.2</span> <em>API</em></h4>
<p>Debido a que el <em>API</em> consume sus datos de <em>MongoDB</em> así como también requiere de una conexión mediante <em>Celery</em> a <em>RabbitMQ</em> para poder realizar las tareas de <em>NER</em>, es posible tener varias instancias del mismo de manera tal que cada una se conecte al cluster de los dos servicios. Es posible mediante el uso de un <em>Load Balancer</em> generar un cluster de servicios de <em>API</em>.</p>
</div>
<div id="worker-2" class="section level4">
<h4><span class="header-section-number">4.4.3.3</span> <em>Worker</em></h4>
<p>Dado que cada <em>worker</em> está implementado como un <em>Celery worker</em>, mientras la configuración del mismo sea correcta, al levantar nuevos containers será posible escalarlo horizontalmente. Incluído en el repositorio de <em>NERd</em> está un comando de <em>Makefile</em> que permite escalar el servicio worker:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="fu">make</span> scale-up <span class="co"># Crea un nuevo worker localmente</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="fu">make</span> scale-down <span class="co"># Destruye un worker localmente</span></a></code></pre></div>
</div>
<div id="rabbitmq-cluster" class="section level4">
<h4><span class="header-section-number">4.4.3.4</span> <em>RabbitMQ cluster</em></h4>
<p><em>RabbitMQ</em> está pensado desde su concepción para poder escalar horizontalmente<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a>, por lo que para tener varias instancias de cola de mensajes será necesario corregir la configuración del servicio.</p>
</div>
<div id="mongodb-cluster" class="section level4">
<h4><span class="header-section-number">4.4.3.5</span> <em>MongoDB cluster</em></h4>
<p>Al igual que <em>RabbitMQ</em>, <em>MongoDB</em> fue diseñado para escalar horizontalmente (ver <a href="implementation.html#MongoDBDev">Base de datos</a>), por lo que para poder escalar horizontalmente la base de datos será necesario modificar la configuración del contenedor para que forme parte de un cluster.</p>
</div>
</div>
</div>
<div id="escenarios" class="section level2">
<h2><span class="header-section-number">4.5</span> Escenarios</h2>
<blockquote>
<p>La descripción de una arquitectura se ilustra utilizando un pequeño conjunto de casos de uso, o escenarios, que se convierten en una quinta vista.
Los escenarios describen secuencias de interacciones entre objetos y entre procesos.
Se utilizan para identificar elementos arquitectónicos y para ilustrar y validar el diseño de la arquitectura.
También sirven como punto de partida para las pruebas de un prototipo de arquitectura.
Esta vista también se conoce como vista de caso de uso.</p>
</blockquote>
<div id="inferencia-de-entidades-utilizando-el-api" class="section level3">
<h3><span class="header-section-number">4.5.1</span> Inferencia de entidades utilizando el API</h3>
<p>Como podemos ver en la figura <a href="implementation.html#fig:scenarios-ner">4.37</a>, para realizar el reconocimiento de entidades nombradas, deben intervenir cuatro actores.</p>
<p>Cuando un <em>cliente</em> realiza un pedido al <em>API</em>, crea una nueva tarea en la cola correspondiente al snapshot especificado por la versión en el <em>request</em> en <em>RabbitMQ</em>. Luego, un único <em>worker</em> que esté escuchando la cola para esa versión va a tomar la tarea, realizar la tarea de inferencia y asignarle un resultado a esa tarea. Finalmente, <em>RabbitMQ</em> notifica al <em>API</em> de la tarea y este puede devolver finalmente el resultado al <em>cliente</em>.</p>
<div class="figure" style="text-align: center"><span id="fig:scenarios-ner"></span>
<img src="assets/mermaid/scenarios-ner.png" alt="Flujo de NER."  />
<p class="caption">
Figura 4.37: Flujo de NER.
</p>
</div>
</div>
<div id="corrección-de-entidades-utilizando-el-entrenador" class="section level3">
<h3><span class="header-section-number">4.5.2</span> Corrección de entidades utilizando el entrenador</h3>
<p>Para realizar una corrección, el usuario deberá realizar los siguientes pasos:</p>
<ul>
<li>Ingresar al sistema con credenciales que tengan el permiso para entrenar.</li>
<li>Hacer <em>click</em> en el botón de <strong>ENTRENAR</strong>.</li>
<li>Esperar a que cargue el texto.</li>
<li>Revisar las entidades y corregir como sea necesario.</li>
<li>Hacer <em>click</em> en el botón <strong>ACEPTAR</strong>.</li>
</ul>
<p>Como podemos ver en la figura <a href="implementation.html#fig:scenarios-web-train">4.38</a>, para poder mostrar un texto a entrenar son necesarios cinco servicios.</p>
<p>El proceso de la inferencia es el mismo que el mostrado en la figura <a href="implementation.html#fig:scenarios-ner">4.37</a>, agregándose la consulta a <em>MongoDB</em> al principio para poder obtener un texto que aún no haya sido entrenado por el usuario logueado.</p>
<div class="figure" style="text-align: center"><span id="fig:scenarios-web-train"></span>
<img src="assets/mermaid/scenarios-web-train.png" alt="Pedido de texto para entrenamiento."  />
<p class="caption">
Figura 4.38: Pedido de texto para entrenamiento.
</p>
</div>
</div>
<div id="habilitar-snapshots" class="section level3">
<h3><span class="header-section-number">4.5.3</span> Habilitar snapshots</h3>
<p>Cuando un usuario necesita comparar dos snapshots, precisa tener al menos un <em>worker</em> de cada versión levantado. En la figura <a href="implementation.html#fig:scenarios-worker-snapshot-change">4.39</a>, ante una tarea de reasignación de snapshot, el <em>worker</em> se desuscribe de la cola de mensajes del <em>snapshot</em> que está escuchando actualmente y se suscribe a la cola de mensajes del <em>snapshot</em> al que se lo quiere cambiar. Luego, se recarga el modelo.</p>
<div class="figure" style="text-align: center"><span id="fig:scenarios-worker-snapshot-change"></span>
<img src="assets/mermaid/scenarios-worker-snapshot-change.png" alt="Cambio de modelo."  />
<p class="caption">
Figura 4.39: Cambio de modelo.
</p>
</div>

<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<h3>Referencias</h3>
<div id="refs" class="references">
<div id="ref-bitnami">
<p>Bitnami. (2019). Retrieved November 22, 2019, from <a href="https://bitnami.com/">https://bitnami.com/</a></p>
</div>
<div id="ref-celery">
<p>Celery: Distributed task queue. (2019). Retrieved November 20, 2019, from <a href="http://www.celeryproject.org/">http://www.celeryproject.org/</a></p>
</div>
<div id="ref-docker">
<p>Docker. (2019). Retrieved November 20, 2019, from <a href="https://www.docker.com/">https://www.docker.com/</a></p>
</div>
<div id="ref-dockercompose">
<p>Docker compose. (2019). Retrieved November 20, 2019, from <a href="https://docs.docker.com/compose/">https://docs.docker.com/compose/</a></p>
</div>
<div id="ref-pep-3333">
<p>Eby, P. (2010). Python web server gateway interface. Retrieved from <a href="https://www.python.org/dev/peps/pep-3333/">https://www.python.org/dev/peps/pep-3333/</a></p>
</div>
<div id="ref-react">
<p>Facebook. (2019). React: A javascript library for building user interfaces. Retrieved November 20, 2019, from <a href="https://reactjs.org/">https://reactjs.org/</a></p>
</div>
<div id="ref-flask">
<p>Flask: Lightweight wsgi web application framework. (2019). Retrieved November 20, 2019, from <a href="https://palletsprojects.com/p/flask/">https://palletsprojects.com/p/flask/</a></p>
</div>
<div id="ref-oauth2">
<p>Group, I. O. W. (2017). OAuth 2.0. Retrieved October 1, 2017, from <a href="https://oauth.net/2/">https://oauth.net/2/</a></p>
</div>
<div id="ref-JWT">
<p>Jones, M., Bradley, J., Sakimura, N, NRI, &amp; Microsoft. (2015). JSON web token. Retrieved November 20, 2019, from <a href="https://tools.ietf.org/html/rfc7519">https://tools.ietf.org/html/rfc7519</a></p>
</div>
<div id="ref-Kruchten:1995:VMA:624610.625529">
<p>Kruchten, P. (1995). The 4+1 view model of architecture. <em>IEEE Softw.</em>, <em>12</em>(6), 42–50. <a href="https://doi.org/10.1109/52.469759">https://doi.org/10.1109/52.469759</a></p>
</div>
<div id="ref-mongodb">
<p>MongoDB: The database for modern applications. (2019). Retrieved November 20, 2019, from <a href="https://www.mongodb.com">https://www.mongodb.com</a></p>
</div>
<div id="ref-flower">
<p>Movsisyan, M. (2016). Flower. Retrieved November 20, 2019, from <a href="https://flower.readthedocs.io/">https://flower.readthedocs.io/</a></p>
</div>
<div id="ref-nginx">
<p>Nginx. (2019). Retrieved November 22, 2019, from <a href="https://www.nginx.com/">https://www.nginx.com/</a></p>
</div>
<div id="ref-python_gil">
<p>Python: Thread state and the global interpreter lock. (2019). Retrieved from <a href="https://docs.python.org/3/c-api/init.html#thread-state-and-the-global-interpreter-lock">https://docs.python.org/3/c-api/init.html#thread-state-and-the-global-interpreter-lock</a></p>
</div>
<div id="ref-rabbitmq">
<p>RabbitMQ. (2019). Retrieved November 20, 2019, from <a href="https://www.rabbitmq.com/">https://www.rabbitmq.com/</a></p>
</div>
<div id="ref-typescript">
<p>Typescript. (2019). Retrieved November 22, 2019, from <a href="https://www.typescriptlang.org/">https://www.typescriptlang.org/</a></p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="2">
<li id="fn2"><p><a href="https://docs.mongodb.com/manual/sharding/" class="uri">https://docs.mongodb.com/manual/sharding/</a><a href="implementation.html#fnref2" class="footnote-back">↩</a></p></li>
<li id="fn3"><p><a href="https://docs.mongodb.com/manual/replication/" class="uri">https://docs.mongodb.com/manual/replication/</a><a href="implementation.html#fnref3" class="footnote-back">↩</a></p></li>
<li id="fn4"><p><a href="https://www.docker.com/resources/what-container" class="uri">https://www.docker.com/resources/what-container</a><a href="implementation.html#fnref4" class="footnote-back">↩</a></p></li>
<li id="fn5"><p><a href="https://www.rabbitmq.com/clustering.html" class="uri">https://www.rabbitmq.com/clustering.html</a><a href="implementation.html#fnref5" class="footnote-back">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="state-of-art.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="results.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/qcho/nerd-pf/edit/master/04-implementation.Rmd",
"text": "Editar"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["nerd-pf.pdf", "nerd-pf.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
